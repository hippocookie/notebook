# ElasticSearch Cluster

## Node

每个节点就是一个ElasticSearch实例，一个服务器上可以存在多个节点，但一般只部署一个节点。

### 节点角色

- master: 候选节点（非主节点，master宕机时替代节点）
- data: 数据节点
  - data_content: 数据内容节点
  - data_hot: 热节点
  - data_warn: 索引不在定期更新，但仍和查询
  - data_code: 冷节点，只读索引
- ingest: 预处理节点，作为类似于Logstash中的Filter
- ml: 机器学习节点
- remote_cluster_client: 候选客户端节点
- transform: 转换节点
- voting_only: 仅投票节点

## 分片

一个索引包含一个或多个分片，在7.0之前默5个主分片，每个主分片一个副本；在7.0之后默认一个主分片。副本可以在索引创建之后修改数量，但是主分片的数量一旦确定不可修改，只能创建索引。

每一个分片都是一个Lucene实例，有完整的创建索引和处理请求的能力。

ES回自动在nodes上做分片均衡。

一个doc不可能同时存在于多个主分片中，但是当每个主分片的副本数量不为1时，可以同时存在于多个副本中。

每个主分片和其副本分片不能同时存在于同一个节点上，所以最低的可用配置是两个节点互为主备。

副本分片无法直接写入数据，从主分片同步，作用是增加数据的安全性，提高服务可用性和并发查询性能。
