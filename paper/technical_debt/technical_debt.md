# 技术债务
## 什么是技术债务

> 第一次发布代码，就好比借了一笔钱。只要通过不断重写来偿还债务，小额负债可以加速开发。但久未偿还债务会引发危险。复用马马虎虎的代码，类似于负债的利息。整个部门有可能因为松散的实现设计或其他诸如此类的负债而陷入窘境。 -- 沃德·库宁汉姆(Ward Cunningham)

在开发团队中，技术债务(Technical Debt)通常用于描述为了实现短期的收益，而在技术决策、代码架构以及代码质量上造成的妥协，这些妥协从长远看来，是不利于软件演进的。作为一个专业术语，技术债务经常用于编码人员之间交流，或向非技术人员阐述当前软件中存在的降低开发效率等问题。

技术债务是一个多方面的综合问题，想要有效的解决它需要了解软件演进、风险管理、质量评估、软件指标、项目分析和软件质量等多方面研究。解决技术债务首先要识别项目的痛点，只有深刻理解项目的背景，才能给出有效的改进措施[4]。


## 技术债务如何产生
项目开发过程实际上也是一个学习的过程，即便是经验丰富的开发人员，也无法在一个项目的初期就给出最合理、最适用的终极设计方案，编写出简洁、测试用例完备的代码。即使在开发完成后，软件的功能完善，代码整洁，也会发现有部分实现是可以使用更好的方案进行优化。这时实际上是存在“无意的”技术债务。

可以根据债务的决策方式，可以从鲁莽/谨慎，有意/无意的角度，将其分为如下类型[1]:
||鲁莽的|谨慎的|
|---|---|---|
|有意的|没有时间去进行设计|需要即刻实现，可以承担对应后果|
|无意的|没有设计的概念|开发完成后发现更好的方案|

对于技术债务来说，“无意识”债务是因为缺乏系统性的设计、编写不规范代码、与决策不相关的低质量软件；相对而言“有意识”是指通过详细评估后，决定为保证当前的收益而承担未来的债务。技术债务一个非常重要的影响是它需要进行偿还的，如果债务增长到足够大，最终会在偿还债务上花更多的经历，债务造成的损耗会远高于产生它而带来的价值。一个常见的例子是遗留的代码库，在这个代码库中要花费大量的工作来保持生产系统的运行（即“偿还债务”），几乎没有剩余时间来添加新功能。



## 如何追踪技术债务
与金融债务不同的是，技术债务不容易显现其影响，尤其是在债务积累阶段，人们很容易忽视它，直到未来某一天变为了开发团队中沉重的负担，严重降低开发效率时，团队不得不停下来专门解决、偿还这个债务。

可以通过两种方式来追踪[3]:
- **在缺陷跟踪系统中维护一个债务清单**。每次发生债务时，偿还债务所需的任务都会与估计的工作量和时间表一起输入系统。然后跟踪债务积压情况，任何超过90天的未解决债务都被视为关键问题。
- **将债务列表作为产品开发备忘录的一部分**。每个债务都被视为一个Scrum“故事”，并且用Scrum中其他故事的估计方法来估计偿还每个债务的估计工作量和时间表。

不同团队对于技术债务的偿还能力是不一样的，其中一个关键影响因素是团队产生无意识债务的程度，团队通过非故意的低质量工作为自己创造的债务越少，就越能出于战略考虑安全地吸收债务。一旦一个团队的开发进度因偿还技术债务而开始下降，团队应该专注于减少债务，直到其开发速度恢复。另一种方法是跟踪返工，并用它来衡量一个团队累积了多少债务[3]。


## 如何识别技术债务
目前在生产过程中，可以从以下几种方式来识别、评估技术债务状况[2]：
|类别|描述|
|---|---|
|代码分析|通过分析源代码，识别存在的违反编码规范、缺少测试的代码；通过度量代码数据，识别设计或架构上的问题|
|依赖分析|分析软件组件、模块依赖|
|检查表|检查是否存在预先定义的技术债务出现场景|
|解决方案对比|比较当前实现与最优方案，如果当前方案并不是最优的，则存在技术债务|

## 技术债务度量
我们可以通过分析应用程序的结构质量，对每个问题的严重性进行评级，并对必须解决的问题进行优先级排序，对软件中技术债务情况进行一个预估。其中包含三个变量：必须修复的问题数量、修复问题需要的时间以及修复问题的花费[5]。应用程序中必须修复的结构性问题的数量可以通过对应用程序源代码的静态分析来衡量。
|类别|描述|
|---|---|
|计算模型|通过数学模型或公式计算技术债务|
|代码指标|通过代码指标(metrics)计算技术债务|
|人工预估|有经验的专家对技术债务进行预估|
|代价分类|预估不同类型技术债务的处理成本|
|运营指标|通过产品运行质量指标反馈技术债务|
|解决方案对比|计算现有实现与最优时间之间的差距|

SQALE（基于生命周期期望的软件质量评估）是一种支持软件应用程序源代码评估的方法。此方法在开放源代码许可证下发布，并且免版税。它是一种通用方法，独立于语言和源代码分析工具。
首先要做的是识别规范的代码，称作质量模型，任何不合规行为都会产生债务，而相反如果不违反任一项要求，则没有债务。具体内容和度量需要与开发团队之间达成共识[6]。
例如:
|特性|要求|修复方式|修复代价|
|---|---|---|---|
|维护性|存在注释代码|删除|2min每次出现|
|可变性|包之间无循环引用|重构|1h每次出现|
|可读性|代码需复写equals和hashcode方法|编写方法和UT|1h每次出现|

通过以上方法，我们将代码的技术债务转换为修复的代价，将所有代码中违反规范的修复代价相加起来，成为SQALE质量索引（SQI)。

## 技术债务优先次序
|类别|描述|
|---|---|
|代价/收益分析|如果修复一个技术债务可以带来的收益远大于修复代价，那么这个技术债务应当优先进行修复，具有更薄代价/收益比的技术债务优先级越高|
|高修复代价优先|具有更高修复代价的技术债务优先修复|
|投资组合方式|将技术债务与其他新功能或bugs一同进行考虑，选择最大收益、最低风险的组合|
|高代价优先|存在造成更高代价的技术债务优先进行修复|

## 技术债务监控
|类别|描述|
|---|---|
|阈值方法|定义技术债务相关的代码质量指标，当超过相关阈值时进行警告|
|技术债务传播跟踪|追踪技术债务对相关依赖系统产生的影响|
|计划检查|周期检查已识别的技术债务，追踪其变化|
|质量属性监控|监控不利于技术债务的质量属性变化，例如稳定性|
|技术债务图表|绘制技术债务随时间变化的各种聚合度量，并观察曲线的形状以观察趋势|

## 技术债务偿还
|类别|描述|
|---|---|
|重构|在不改变软件系统外部行为的情况下，对软件系统的代码、设计或体系结构进行更改，以提高内部质量|
|重写|重写包含技术债务的代码|
|自动化|自动化手动重复工作，例如手动测试、手动构建和手动部署|
|再造|改进现有软件以展示新的行为、特性和操作质量|
|重新包装|将具有可管理依赖的内聚模块分组以简化代码|
|修复Bug|修复已知Bug|
|容错|有意的使用运行时异常表示技术债务的存在|

## 技术债务交流
|类别|描述|
|---|---|
|技术债务dashboard|展示技术债务项目、类型和数量，以便让所有利益相关者了解技术债务的存在|
|Backlog|所有确定的技术债务项以及开发中需要解决的任何问题都被放入软件项目的backlog中，这样技术债务项就可以被视为已知缺陷和未实现的计划特性和功能|
|依赖可视化|展示软件组件中不合理的依赖|
|代码指标可视化|高亮展示指标较差的代码|
|技术债务传播可视化|展示技术债务之间相互的联系以及相互之间的影响|

## 技术债务预防
|类别|描述|
|---|---|
|开发流程优化|通过优化开发流程，防止某些类型技术债务出现|
|架构决策支持|评估不同架构设计方案所造成的潜在技术债务，然后选择潜在技术债务较小的方案|
|生命周期成本规划|制定经济高效的计划，在整个生命周期中最小化系统的总体技术债务|
|人为因素分析|通过培养文化，最大限度地减少人为因素（如冷漠和无知）造成的无意技术债务|



[1] Fowler, M. Technical Debt Quadrant. Bliki [Blog] 2009.[cited 2010 June 14]; Available from:
http://www.martinfowler.com/bliki/TechnicalDebtQuadrant.html.
[2] Paris Avgeriou, University of Groningen, A Systematic Mapping Study on Technical Debt and Its Management,Journal of Systems and Software December 2014.
[3] S. McConnell, Managing Technical Debt, in, Construx, 2008, pp. 1-14. URL:
http://www.construx.com/uploadedFiles/Construx/Construx_Content/Resources/Documents/Managing%
20Technical%20Debt.pdf, accessed: 18-10-2014.
[4] Neil A. Ernst, Stephany Bellomo, Ipek Ozkaya, Robert L. Nord, and Ian Gorton, Measure It? Manage It? Ignore It? Software Practitioners and Technical Debt, Carnegie Mellon University Software Engineering Institute Pittsburgh, PA, USA.
[5] B. Curtis, J. Sappidi, A. Szynkarski, Estimating the size, cost, and types of Technical Debt, in:
Proceedings of the 3rd International Workshop on Managing Technical Debt (MTD'12), IEEE, Zurich,
Switzerland, 2012, pp. 49-53.
[6]J.-L. Letouzey, The SQALE method for evaluating Technical Debt, in: Proceedings of the 3rd
International Workshop on Managing Technical Debt (MTD'12), IEEE, Zurich, Switzerland, 2012, pp.
31-36.